# Configura√ß√£o do Smithery para WAHA MCP PLUS
apiVersion: v1
kind: MCPServer

metadata:
  name: waha-mcp-plus
  description: "üöÄ WAHA MCP PLUS - Premium WhatsApp Automation Server com IA, Analytics e Campanhas"
  version: "1.0.0-plus"
  author: "FastMCP Premium Team"
  license: "MIT"
  tags:
    - whatsapp
    - premium
    - automation
    - ai
    - analytics
    - campaigns
    - marketing
    - chatbot
    - bulk-messaging

spec:
  # Configura√ß√£o da build
  build:
    type: docker
    dockerfile: Dockerfile.plus
    context: .
    
  # Configura√ß√£o do runtime
  runtime:
    entrypoint: ["uv", "run", "python", "waha_mcp_plus.py"]
    workingDirectory: /app
    
    # Vari√°veis de ambiente premium
    environment:
      WAHA_BASE_URL: "http://localhost:3000"
      WAHA_DEFAULT_SESSION: "default"
      WAHA_ENABLE_ANALYTICS: "true"
      WAHA_ENABLE_AUTO_REPLY: "true"
      WAHA_ENABLE_RATE_LIMITING: "true"
      WAHA_MAX_REQUESTS_PER_MINUTE: "60"
      WAHA_MAX_SESSIONS: "10"
      PYTHONPATH: "/app"
    
    # Recursos computacionais premium
    resources:
      cpu: "1.0"
      memory: "1Gi"
      storage: "2Gi"
    
    # Portas expostas
    ports:
      - containerPort: 8000
        protocol: TCP
        name: mcp
      - containerPort: 8080
        protocol: TCP
        name: dashboard
    
  # Configura√ß√£o do servidor MCP
  mcp:
    # Protocolo de comunica√ß√£o
    transport: stdio
    
    # Capacidades premium
    capabilities:
      tools: true
      resources: false
      prompts: false
      streaming: true
      
    # Ferramentas premium dispon√≠veis
    tools:
      # === SESS√ïES AVAN√áADAS ===
      - name: create_multi_session
        description: "Criar m√∫ltiplas sess√µes WhatsApp simultaneamente"
        category: "premium-sessions"
        parameters:
          - name: session_names
            type: array
            required: true
            description: "Lista de nomes para as sess√µes"
          - name: config
            type: object
            required: false
            description: "Configura√ß√£o personalizada para as sess√µes"
            
      - name: get_sessions_status
        description: "Status detalhado de todas as sess√µes com informa√ß√µes premium"
        category: "premium-sessions"
        
      # === MENSAGENS INTELIGENTES ===
      - name: send_smart_message
        description: "Enviar mensagem inteligente com recursos avan√ßados"
        category: "premium-messaging"
        parameters:
          - name: chat_id
            type: string
            required: true
            description: "ID do chat de destino"
          - name: message
            type: string
            required: true
            description: "Conte√∫do da mensagem"
          - name: priority
            type: string
            required: false
            description: "Prioridade da mensagem (low, normal, high, urgent)"
          - name: schedule_time
            type: string
            required: false
            description: "Agendamento da mensagem (ISO format)"
          - name: auto_translate
            type: boolean
            required: false
            description: "Tradu√ß√£o autom√°tica"
            
      - name: send_bulk_messages
        description: "Enviar mensagens em massa com controle de delay"
        category: "premium-messaging"
        parameters:
          - name: targets
            type: array
            required: true
            description: "Lista de alvos com chat_id e message"
          - name: delay_seconds
            type: integer
            required: false
            description: "Delay entre mensagens"
            
      # === ANALYTICS PREMIUM ===
      - name: get_analytics_dashboard
        description: "Dashboard completo de analytics com m√©tricas avan√ßadas"
        category: "premium-analytics"
        parameters:
          - name: hours
            type: integer
            required: false
            description: "Per√≠odo em horas para an√°lise"
            
      - name: generate_usage_report
        description: "Relat√≥rio detalhado de uso com an√°lise temporal"
        category: "premium-analytics"
        parameters:
          - name: days
            type: integer
            required: false
            description: "Per√≠odo em dias para o relat√≥rio"
            
      # === AUTO REPLY ===
      - name: configure_auto_reply
        description: "Configurar regras de resposta autom√°tica inteligente"
        category: "premium-automation"
        parameters:
          - name: trigger_patterns
            type: array
            required: true
            description: "Padr√µes que acionam a resposta"
          - name: response_template
            type: string
            required: true
            description: "Template da resposta autom√°tica"
          - name: rule_name
            type: string
            required: true
            description: "Nome da regra"
          - name: priority
            type: integer
            required: false
            description: "Prioridade da regra"
            
      - name: list_auto_reply_rules
        description: "Listar todas as regras de auto-resposta"
        category: "premium-automation"
        
      - name: test_auto_reply
        description: "Testar sistema de resposta autom√°tica"
        category: "premium-automation"
        parameters:
          - name: message
            type: string
            required: true
            description: "Mensagem para testar"
            
      # === CAMPANHAS DE MARKETING ===
      - name: create_marketing_campaign
        description: "Criar campanha de marketing avan√ßada"
        category: "premium-campaigns"
        parameters:
          - name: campaign_name
            type: string
            required: true
            description: "Nome da campanha"
          - name: target_chats
            type: array
            required: true
            description: "Lista de chats alvos"
          - name: message_template
            type: string
            required: true
            description: "Template da mensagem"
          - name: schedule_time
            type: string
            required: false
            description: "Agendamento da campanha"
            
      - name: start_campaign
        description: "Iniciar execu√ß√£o de campanha"
        category: "premium-campaigns"
        parameters:
          - name: campaign_id
            type: string
            required: true
            description: "ID da campanha"
            
      - name: get_campaign_report
        description: "Relat√≥rio detalhado da campanha"
        category: "premium-campaigns"
        parameters:
          - name: campaign_id
            type: string
            required: true
            description: "ID da campanha"
            
      # === AGENDAMENTO ===
      - name: list_scheduled_messages
        description: "Listar mensagens agendadas"
        category: "premium-scheduling"
        
      - name: cancel_scheduled_message
        description: "Cancelar mensagem agendada"
        category: "premium-scheduling"
        parameters:
          - name: message_id
            type: string
            required: true
            description: "ID da mensagem agendada"
            
      # === MONITORAMENTO PREMIUM ===
      - name: system_health_check
        description: "Verifica√ß√£o completa de sa√∫de do sistema"
        category: "premium-monitoring"

  # Configura√ß√£o de depend√™ncias
  dependencies:
    services:
      - name: waha
        description: "Servidor WAHA (WhatsApp HTTP API)"
        image: "devlikeapro/waha:latest"
        ports:
          - "3000:3000"
        environment:
          WAHA_WEBHOOK_URL: "http://localhost:8000/webhook"
          WAHA_WEBHOOK_EVENTS: "message,session.status,message.ack"
        required: true
        
      - name: redis
        description: "Redis para cache e analytics avan√ßados"
        image: "redis:7-alpine"
        ports:
          - "6379:6379"
        required: false
        
  # Documenta√ß√£o premium
  documentation:
    readme: |
      # üöÄ WAHA MCP PLUS - Premium WhatsApp Automation
      
      ## ‚ú® Funcionalidades Premium
      
      ### ü§ñ **Intelig√™ncia Artificial**
      - Respostas autom√°ticas inteligentes
      - An√°lise de sentimento
      - Tradu√ß√£o autom√°tica
      - Processamento de linguagem natural
      
      ### üìä **Analytics Avan√ßados**
      - Dashboard em tempo real
      - M√©tricas de performance
      - An√°lise de engajamento
      - Relat√≥rios customizados
      
      ### üéØ **Campanhas de Marketing**
      - Envio em massa inteligente
      - Segmenta√ß√£o de audi√™ncia
      - A/B testing
      - ROI tracking
      
      ### ‚ö° **Performance Premium**
      - Rate limiting inteligente
      - Cache avan√ßado
      - M√∫ltiplas sess√µes
      - Processamento ass√≠ncrono
      
      ## üõ†Ô∏è Configura√ß√£o Premium
      
      Configure as vari√°veis de ambiente:
      
      ```env
      # B√°sico
      WAHA_BASE_URL=http://localhost:3000
      WAHA_API_KEY=your_premium_key
      
      # Premium Features
      WAHA_ENABLE_ANALYTICS=true
      WAHA_ENABLE_AUTO_REPLY=true
      WAHA_MAX_SESSIONS=10
      WAHA_MAX_REQUESTS_PER_MINUTE=100
      
      # IA (Opcional)
      OPENAI_API_KEY=your_openai_key
      
      # Redis (Opcional)
      REDIS_URL=redis://localhost:6379
      ```
      
      ## üöÄ Funcionalidades Exclusivas
      
      ### Multi-Session Management
      ```python
      # Criar m√∫ltiplas sess√µes
      create_multi_session(["vendas", "suporte", "marketing"])
      ```
      
      ### Bulk Messaging
      ```python
      # Envio em massa com delay inteligente
      send_bulk_messages([
          {"chat_id": "user1", "message": "Oferta especial!"},
          {"chat_id": "user2", "message": "Promo√ß√£o limitada!"}
      ], delay_seconds=2)
      ```
      
      ### Auto-Reply Engine
      ```python
      # Configurar resposta autom√°tica
      configure_auto_reply(
          trigger_patterns=["pre√ßo", "valor", "custo"],
          response_template="Nossos pre√ßos s√£o muito competitivos! Vou enviar nossa tabela.",
          rule_name="Consulta de Pre√ßos"
      )
      ```
      
      ### Analytics Dashboard
      ```python
      # Dashboard completo
      dashboard = get_analytics_dashboard(hours=24)
      print(f"Taxa de sucesso: {dashboard['summary']['success_rate']}")
      ```
      
      ### Marketing Campaigns
      ```python
      # Criar campanha
      campaign_id = create_marketing_campaign(
          campaign_name="Black Friday 2025",
          target_chats=["user1", "user2", "user3"],
          message_template="üî• Descontos de at√© 70% na Black Friday!"
      )
      
      # Executar campanha
      start_campaign(campaign_id)
      ```
      
    examples: |
      ## üéØ Casos de Uso Premium
      
      ### üè¢ **E-commerce Automation**
      ```python
      # Notifica√ß√£o de abandono de carrinho
      configure_auto_reply(
          trigger_patterns=["carrinho", "esqueci", "finalizar"],
          response_template="Vi que voc√™ esqueceu itens no carrinho! üõí\nFinalize agora e ganhe 10% de desconto: FINISH10",
          rule_name="Abandono de Carrinho"
      )
      ```
      
      ### üìà **Lead Nurturing**
      ```python
      # Campanha de nutri√ß√£o
      campaign = create_marketing_campaign(
          campaign_name="Nutri√ß√£o Q1 2025",
          target_chats=leads_qualificados,
          message_template="üéØ Conte√∫do exclusivo sobre {topic}\nBaixe nosso e-book gratuito: {link}"
      )
      ```
      
      ### üé™ **Event Marketing**
      ```python
      # Lembrete de evento
      send_smart_message(
          chat_id="event_list",
          message="üìÖ Lembrete: Nosso webinar come√ßa em 1 hora!\nLink: {webinar_link}",
          schedule_time="2025-06-15T14:00:00",
          priority="high"
      )
      ```
      
      ### üìä **Business Intelligence**
      ```python
      # Relat√≥rio executivo
      report = generate_usage_report(days=30)
      
      # Analytics personalizados
      dashboard = get_analytics_dashboard(hours=168)  # 7 dias
      
      top_performers = dashboard['top_chats'][:5]
      conversion_rate = calculate_conversion(dashboard)
      ```
      
  # Health checks premium
  health:
    readiness:
      path: /health
      port: 8000
      initialDelaySeconds: 45
      periodSeconds: 10
      
    liveness:
      path: /health
      port: 8000
      initialDelaySeconds: 90
      periodSeconds: 30
      
    # Custom health checks
    custom:
      - name: waha_connectivity
        command: ["python", "-c", "import httpx; httpx.get('http://localhost:3000/ping').raise_for_status()"]
        intervalSeconds: 60
        
      - name: analytics_engine
        command: ["python", "-c", "from waha_mcp_plus import cache; assert len(cache._analytics) >= 0"]
        intervalSeconds: 300

  # Configura√ß√µes de seguran√ßa
  security:
    # Rate limiting global
    rateLimit:
      enabled: true
      requestsPerMinute: 100
      burstSize: 20
      
    # Valida√ß√£o de entrada
    inputValidation:
      enabled: true
      maxMessageLength: 4096
      allowedFileTypes: ["image/jpeg", "image/png", "application/pdf"]
      
    # Logs de auditoria
    audit:
      enabled: true
      logLevel: "INFO"
      retentionDays: 30

  # M√©tricas e observabilidade
  observability:
    metrics:
      enabled: true
      endpoint: "/metrics"
      port: 8080
      
    tracing:
      enabled: true
      sampling: 0.1
      
    logging:
      level: "INFO"
      format: "json"
      outputs: ["stdout", "file"]

  # Configura√ß√µes de performance
  performance:
    # Cache configuration
    cache:
      enabled: true
      provider: "memory"  # ou "redis" se dispon√≠vel
      defaultTTL: 3600
      maxSize: "256MB"
      
    # Connection pooling
    connectionPool:
      maxConnections: 50
      maxIdleTime: 300
      
    # Async processing
    async:
      enabled: true
      maxWorkers: 10
      queueSize: 1000
